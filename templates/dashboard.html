{% extends 'base.html' %}
{% block title %}Dashboard{% endblock %}
{% block content %}
<div class="container mt-2">
    <nav class="navbar navbar-expand-lg navbar-light bg-light shadow p-3 mb-2 bg-body rounded">
        <div class="container">
            <a class="navbar-brand text-capitalize">Welcome, {{ current_user.username }}!</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
                aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse justify-content-end" id="navbarNav">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="btn btn-danger text-light" href="/logout">Logout</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="mt-2 mb-4 shadow-lg p-4 bg-body rounded">
        <h5 class="mb-4">Ask your query</h5>
        <form id="chat-form" method="post">
            <div class="mb-3">
                <input type="text" name="question" id="question" class="form-control" placeholder="Type your question here">
            </div>
            <button type="submit" class="btn btn-primary">Submit</button>
        </form>

        <h5 class="mt-4">Generate Summary</h5>

        <form id="summary-form" method="post">
            <div class="mb-3">
                <input type="text" name="summary" id="summary" class="form-control" placeholder="Type your summary here">
            </div>
            <button type="submit" class="btn btn-secondary">Generate Summary</button>
        </form>

        <h5 class="mt-4">Solution</h5>
      
        <!-- Progress bar -->
        <div class="progress" id="progress" style="display: none;">
            <div class="progress-bar progress-bar-striped progress-bar-animated" 
                 role="progressbar" 
                 aria-valuenow="0" 
                 aria-valuemin="0" 
                 aria-valuemax="100" 
                 style="width: 0;"></div>
        </div>

        <div id="answer" class="p-3 border border-dark" style="min-height: 180px;">
            <p class="fst-italic" id="solutionText">{{ answer }}</p>
        </div>
        
        <button id="copyButton" onclick="copyToClipboard()" class="btn btn-success mt-3">Copy Answer</button>
        <button id="clearButton" onclick="clearAnswer()" class="btn btn-danger mt-3">Clear Answer</button>
    </div>
</div>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="{{ url_for('static', filename='js/dashboard.js') }}"></script>
<script>
    $(document).ready(function() {
        $("#summary-form").submit(function(event) {
            event.preventDefault();
            var summaryText = $("#summary").val();
            $.ajax({
                type: "POST",
                url: "/dashboard",
                data: {summary: summaryText},
                success: function(response) {
                    $("#solutionText").text(response.summary_result);
                }
            });
        });
    });
</script>
{% endblock content %}
